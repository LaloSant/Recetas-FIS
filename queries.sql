-------------------------------------------------------------------------------
CREATE TABLE ROL (
	ID_ROL      VARCHAR2(5) DEFAULT 'USER'
		CONSTRAINT ROL_ID_PK PRIMARY KEY
	,NOMBRE      VARCHAR2(10)
		CONSTRAINT ROL_NOMBRE_NN NOT NULL
	,DESCRIPCION VARCHAR2(20)
		CONSTRAINT ROL_DESCRIPCION_NN NOT NULL
);

CREATE TABLE USUARIOS (
	ID_USUARIO  NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT USR_ID_USR_PK PRIMARY KEY
	,ID_ROL      VARCHAR2(5)
		CONSTRAINT USR_ROL_NN NOT NULL
		CONSTRAINT USR_ROL_FK
			REFERENCES ROL ( ID_ROL )
	,NOMBRE      VARCHAR2(50)
		CONSTRAINT USR_NOMBRE_NN NOT NULL
	,EMAIL       VARCHAR2(50)
		CONSTRAINT USR_EMAIL_NN NOT NULL
		CONSTRAINT USR_EMAIL_UQ UNIQUE
	,CONTRASENIA VARCHAR2(255)
		CONSTRAINT USR_CONT_NN NOT NULL
);
ALTER TABLE USUARIOS DISABLE CONSTRAINT USR_ROL_NN;

CREATE TABLE RECETAS (
	ID_RECETA         NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT RCT_ID_REC_PK PRIMARY KEY
	,ID_USUARIO        NUMBER
		CONSTRAINT RCT_USUAR_NN NOT NULL
		CONSTRAINT RCT_USUAR_FK
			REFERENCES USUARIOS ( ID_USUARIO )
	,NOMBRE            VARCHAR2(50)
		CONSTRAINT RCT_NOMBRE_NN NOT NULL
	,IMAGEN            BLOB
	,VISITAS_TOTALES   NUMBER DEFAULT 0
	,VISITAS_SEMANALES NUMBER DEFAULT 0
);

CREATE TABLE INGREDIENTES (
	ID_INGREDIENTE NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT INGT_ID_ING_PK PRIMARY KEY
	,NOMBRE         VARCHAR2(50)
		CONSTRAINT INGT_NOMBRE_NN NOT NULL
	,COSTO_UNITARIO NUMBER
	,IMAGEN         BLOB
);

CREATE TABLE DETALLES (
	ID_DETALLE     NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT DET_ID_DET_PK PRIMARY KEY
	,ID_RECETA      NUMBER
		CONSTRAINT DET_ID_REC_FK
			REFERENCES RECETAS ( ID_RECETA )
	,ID_INGREDIENTE NUMBER
		CONSTRAINT DET_ID_ING_FK
			REFERENCES INGREDIENTES ( ID_INGREDIENTE )
	,CANTIDAD       NUMBER
		CONSTRAINT DET_CANTIDAD_NN NOT NULL
	,NOTAS          VARCHAR2(200)
		CONSTRAINT DET_NOTAS_NN NOT NULL
	,COSTO          NUMBER
		CONSTRAINT DET_COSTO_NN NOT NULL
		CONSTRAINT DET_COSTO_CK CHECK ( COSTO >= 0 )
);

CREATE TABLE PETICION_IA (
	ID_PETICION_IA NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT PET_IA_ID_PK PRIMARY KEY
	,ESTATUS        CHAR(3)
		CONSTRAINT PET_EST_CK CHECK ( ESTATUS IN ( 'PEN'
		                                          ,'ENT' ) )
		CONSTRAINT PET_EST_NN NOT NULL
	,DESCRCRIPCION  VARCHAR2(50)
		CONSTRAINT PET_DESC_NN NOT NULL
);

CREATE TABLE PASOS (
	ID_PASO     NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT PASOS_ID_PK PRIMARY KEY
	,ID_RECETA   NUMBER
		CONSTRAINT PASOS_ID_REC_NN NOT NULL
		CONSTRAINT PASOS_ID_REC_FK
			REFERENCES RECETAS ( ID_RECETA )
	,INDICE_PASO NUMBER
		CONSTRAINT PASOS_IND_PASO_NN NOT NULL
	,NOTAS       VARCHAR2(200)
		CONSTRAINT PASOS_NOTAS_NN NOT NULL
	,IMAGEN      BLOB
	,ID_PET_IA   NUMBER
		CONSTRAINT PASOS_ID_PET_IA_FK
			REFERENCES PETICION_IA ( ID_PETICION_IA )
);

DROP TABLE RECETA_INGRED CASCADE CONSTRAINTS;
DROP TABLE USUARIOS CASCADE CONSTRAINTS;
DROP TABLE ROL CASCADE CONSTRAINTS;
DROP TABLE INGREDIENTES CASCADE CONSTRAINTS;
DROP TABLE RECETAS CASCADE CONSTRAINTS;
DROP TABLE PETICION_IA CASCADE CONSTRAINTS;
DROP TABLE PASOS CASCADE CONSTRAINTS;