-------------------------------------------------------------------------------
CREATE TABLE ROL (
	ID_ROL      VARCHAR2(5) DEFAULT 'USER'
		CONSTRAINT ROL_ID_PK PRIMARY KEY
	,NOMBRE      VARCHAR2(10)
		CONSTRAINT ROL_NOMBRE_NN NOT NULL
	,DESCRIPCION VARCHAR2(20)
		CONSTRAINT ROL_DESCRIPCION_NN NOT NULL
);

CREATE TABLE USUARIOS (
	ID_USUARIO  NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT USR_ID_USR_PK PRIMARY KEY
	,ID_ROL      VARCHAR2(5)
		CONSTRAINT USR_ROL_NN NOT NULL
		CONSTRAINT USR_ROL_FK
			REFERENCES ROL ( ID_ROL )
	,NOMBRE      VARCHAR2(50)
		CONSTRAINT USR_NOMBRE_NN NOT NULL
	,EMAIL       VARCHAR2(50)
		CONSTRAINT USR_EMAIL_NN NOT NULL
		CONSTRAINT USR_EMAIL_UQ UNIQUE
	,CONTRASENIA VARCHAR2(255)
		CONSTRAINT USR_CONT_NN NOT NULL
);
ALTER TABLE USUARIOS DISABLE CONSTRAINT USR_ROL_NN;

CREATE TABLE RECETAS (
	ID_RECETA         NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT RCT_ID_REC_PK PRIMARY KEY
	,ID_USUARIO        NUMBER
		CONSTRAINT RCT_USUAR_NN NOT NULL
		CONSTRAINT RCT_USUAR_FK
			REFERENCES USUARIOS ( ID_USUARIO )
	,NOMBRE            VARCHAR2(50)
		CONSTRAINT RCT_NOMBRE_NN NOT NULL
	,IMAGEN            BLOB
	,VISITAS_TOTALES   NUMBER DEFAULT 0
	,VISITAS_SEMANALES NUMBER DEFAULT 0
    ,CALIFICACION      NUMBER DEFAULT 0
        CONSTRAINT RCT_CALIF_CK CHECK (CALIFICACION BETWEEN 0 AND 5)
);

CREATE TABLE INGREDIENTES (
	ID_INGREDIENTE NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT INGT_ID_ING_PK PRIMARY KEY
	,NOMBRE         VARCHAR2(50)
		CONSTRAINT INGT_NOMBRE_NN NOT NULL
	,COSTO_UNITARIO NUMBER
	,IMAGEN         BLOB
);

CREATE TABLE DETALLES (
	ID_DETALLE     NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT DET_ID_DET_PK PRIMARY KEY
	,ID_RECETA      NUMBER
		CONSTRAINT DET_ID_REC_FK
			REFERENCES RECETAS ( ID_RECETA )
	,ID_INGREDIENTE NUMBER
		CONSTRAINT DET_ID_ING_FK
			REFERENCES INGREDIENTES ( ID_INGREDIENTE )
	,CANTIDAD       NUMBER
		CONSTRAINT DET_CANTIDAD_NN NOT NULL
	,NOTAS          VARCHAR2(200)
		CONSTRAINT DET_NOTAS_NN NOT NULL
	,COSTO          NUMBER
		CONSTRAINT DET_COSTO_NN NOT NULL
		CONSTRAINT DET_COSTO_CK CHECK ( COSTO >= 0 )
);

CREATE TABLE PETICION_IA (
	ID_PETICION_IA NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT PET_IA_ID_PK PRIMARY KEY
	,ESTATUS        CHAR(3)
		CONSTRAINT PET_EST_CK CHECK ( ESTATUS IN ( 'PEN'
		                                          ,'ENT' ) )
		CONSTRAINT PET_EST_NN NOT NULL
	,DESCRIPCION  VARCHAR2(50)
		CONSTRAINT PET_DESC_NN NOT NULL
);

CREATE TABLE PASOS (
	ID_PASO     NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT PASOS_ID_PK PRIMARY KEY
	,ID_RECETA   NUMBER
		CONSTRAINT PASOS_ID_REC_NN NOT NULL
		CONSTRAINT PASOS_ID_REC_FK
			REFERENCES RECETAS ( ID_RECETA )
	,INDICE_PASO NUMBER
		CONSTRAINT PASOS_IND_PASO_NN NOT NULL
	,NOTAS       VARCHAR2(200)
		CONSTRAINT PASOS_NOTAS_NN NOT NULL
	,IMAGEN      BLOB
	,ID_PET_IA   NUMBER
		CONSTRAINT PASOS_ID_PET_IA_FK
			REFERENCES PETICION_IA ( ID_PETICION_IA )
);

DROP TABLE DETALLES CASCADE CONSTRAINTS;
DROP TABLE USUARIOS CASCADE CONSTRAINTS;
DROP TABLE ROL CASCADE CONSTRAINTS;
DROP TABLE INGREDIENTES CASCADE CONSTRAINTS;
DROP TABLE RECETAS CASCADE CONSTRAINTS;
DROP TABLE PETICION_IA CASCADE CONSTRAINTS;
DROP TABLE PASOS CASCADE CONSTRAINTS;

-------------------------------------------------------------------------------
-- INSERTS
-------------------------------------------------------------------------------

-- ROL
INSERT INTO ROL (ID_ROL, NOMBRE, DESCRIPCION) VALUES ('ADMIN', 'Admin', 'Administrador');
INSERT INTO ROL (ID_ROL, NOMBRE, DESCRIPCION) VALUES ('MOD', 'Moderador', 'Mod. peticiones IA');
INSERT INTO ROL (ID_ROL, NOMBRE, DESCRIPCION) VALUES ('USER', 'Usuario', 'Usuario regular');

-- USUARIOS
-- Assuming ID_USUARIO starts at 1 and increments.
INSERT INTO USUARIOS (ID_ROL, NOMBRE, EMAIL, CONTRASENIA) VALUES ('MOD', 'Eduardo', 'eduardo@example.com', 'pass123');
INSERT INTO USUARIOS (ID_ROL, NOMBRE, EMAIL, CONTRASENIA) VALUES ('USER', 'Maria', 'maria@example.com', 'pass123');
INSERT INTO USUARIOS (ID_ROL, NOMBRE, EMAIL, CONTRASENIA) VALUES ('USER', 'Juan', 'juan@example.com', 'pass123');

-- RECETAS
-- Assuming ID_RECETA starts at 1 and increments.
INSERT INTO RECETAS (ID_USUARIO, NOMBRE, VISITAS_TOTALES, VISITAS_SEMANALES, CALIFICACION) VALUES (1, 'Tacos al Pastor', 150, 20, 4);
INSERT INTO RECETAS (ID_USUARIO, NOMBRE, VISITAS_TOTALES, VISITAS_SEMANALES, CALIFICACION) VALUES (2, 'Enchiladas Suizas', 200, 30, 3);
INSERT INTO RECETAS (ID_USUARIO, NOMBRE, VISITAS_TOTALES, VISITAS_SEMANALES, CALIFICACION) VALUES (3, 'Pozole Rojo', 100, 10, 2);

-- INGREDIENTES
-- Assuming ID_INGREDIENTE starts at 1 and increments.
INSERT INTO INGREDIENTES (NOMBRE, COSTO_UNITARIO) VALUES ('Carne al pastor', 15.50);
INSERT INTO INGREDIENTES (NOMBRE, COSTO_UNITARIO) VALUES ('Tortillas de maiz', 1.00);
INSERT INTO INGREDIENTES (NOMBRE, COSTO_UNITARIO) VALUES ('Cilantro', 0.50);
INSERT INTO INGREDIENTES (NOMBRE, COSTO_UNITARIO) VALUES ('Cebolla', 0.75);
INSERT INTO INGREDIENTES (NOMBRE, COSTO_UNITARIO) VALUES ('Salsa verde', 2.50);

-- DETALLES
-- Linking RECETAS and INGREDIENTES
INSERT INTO DETALLES (ID_RECETA, ID_INGREDIENTE, CANTIDAD, NOTAS, COSTO) VALUES (1, 1, 500, 'gramos', 77.5);
INSERT INTO DETALLES (ID_RECETA, ID_INGREDIENTE, CANTIDAD, NOTAS, COSTO) VALUES (1, 2, 20, 'unidades', 20);
INSERT INTO DETALLES (ID_RECETA, ID_INGREDIENTE, CANTIDAD, NOTAS, COSTO) VALUES (1, 3, 1, 'manojo', 0.50);
INSERT INTO DETALLES (ID_RECETA, ID_INGREDIENTE, CANTIDAD, NOTAS, COSTO) VALUES (2, 5, 1, 'litro', 2.50);

-- PETICION_IA
INSERT INTO PETICION_IA (ESTATUS, DESCRCRIPCION) VALUES ('PEN', 'Generar imagen para Tacos al Pastor');
INSERT INTO PETICION_IA (ESTATUS, DESCRCRIPCION) VALUES ('ENT', 'Generar imagen para Enchiladas Suizas');
INSERT INTO PETICION_IA (ESTATUS, DESCRCRIPCION) VALUES ('PEN', 'Generar imagen para Pozole Rojo');

-- PASOS
-- Steps for Tacos al Pastor (ID_RECETA = 1)
INSERT INTO PASOS (ID_RECETA, INDICE_PASO, NOTAS) VALUES (1, 1, 'Marinar la carne con el adobo de achiote.');
INSERT INTO PASOS (ID_RECETA, INDICE_PASO, NOTAS) VALUES (1, 2, 'Cocinar la carne en un trompo.');
INSERT INTO PASOS (ID_RECETA, INDICE_PASO, NOTAS) VALUES (1, 3, 'Cortar la carne y servir en tortillas con cilantro y cebolla.');

-- Steps for Enchiladas Suizas (ID_RECETA = 2)
INSERT INTO PASOS (ID_RECETA, INDICE_PASO, NOTAS) VALUES (2, 1, 'Rellenar las tortillas con pollo deshebrado.');
INSERT INTO PASOS (ID_RECETA, INDICE_PASO, NOTAS, ID_PET_IA) VALUES (2, 2, 'Ba√±ar las enchiladas con salsa verde y queso.', 2);

-- Steps for Pozole Rojo (ID_RECETA = 3)
INSERT INTO PASOS (ID_RECETA, INDICE_PASO, NOTAS) VALUES (3, 1, 'Cocer el maiz pozolero con la carne de cerdo.');
INSERT INTO PASOS (ID_RECETA, INDICE_PASO, NOTAS, ID_PET_IA) VALUES (3, 2, 'Agregar la salsa de chiles anchos y guajillos.', 3);
