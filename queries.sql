-------------------------------------------------------------------------------
CREATE TABLE ROL (
	ID_ROL NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT ROL_ID_PK PRIMARY KEY
	,NOMBRE VARCHAR2(10)
		CONSTRAINT ROL_NOMBRE_NN NOT NULL
);

CREATE TABLE USUARIOS (
	ID_USUARIO  NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT USR_ID_USR_PK PRIMARY KEY
	,NOMBRE      VARCHAR2(50)
		CONSTRAINT USR_NOMBRE_NN NOT NULL
	,EMAIL       VARCHAR2(50)
		CONSTRAINT USR_EMAIL_NN NOT NULL
        CONSTRAINT USR_EMAIL_UQ UNIQUE
	,CONTRASENIA VARCHAR2(255)
		CONSTRAINT USR_CONT_NN NOT NULL
	,ID_ROL      NUMBER
		CONSTRAINT USR_ROL_NN NOT NULL
		CONSTRAINT USR_ROL_FK
			REFERENCES ROL ( ID_ROL )
);
ALTER TABLE USUARIOS DISABLE CONSTRAINT USR_ROL_NN;

CREATE TABLE RECETAS (
	ID_RECETA      NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT RCT_ID_REC_PK PRIMARY KEY
	,NOMBRE         VARCHAR2(50)
		CONSTRAINT RCT_NOMBRE_NN NOT NULL
	,FECHA_REGISTRO DATE
);

ALTER TABLE RECETAS ADD IMAGEN BLOB;

CREATE TABLE INGREDIENTES (
	ID_INGREDIENTE NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT INGT_ID_ING_PK PRIMARY KEY
	,NOMBRE         VARCHAR2(50)
		CONSTRAINT INGT_NOMBRE_NN NOT NULL
	,IMAGEN         BLOB
    ,PRECIO_UNITARIO    NUMBER
);

CREATE TABLE RECETA_INGRED (
	ID_REC_ING     NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT RECIN_ID_RI_PK PRIMARY KEY
	,ID_RECETA      NUMBER
		CONSTRAINT RECIN_ID_REC_FK
			REFERENCES RECETAS ( ID_RECETA )
	,ID_INGREDIENTE NUMBER
		CONSTRAINT RECIN_ID_ING_FK
			REFERENCES INGREDIENTES ( ID_INGREDIENTE )
	,CANTIDAD       NUMBER
	,NOTAS          VARCHAR2(200)
    ,COSTO NUMBER
);

CREATE TABLE PETICION_IA(
	ID_PETICION_IA     NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT PET_IA_ID_PK PRIMARY KEY
	,ESTATUS CHAR(1)
		CONSTRAINT PET_EST_CK CHECK(ESTATUS IN ('P', 'E'))
		CONSTRAINT PET_EST_NN NOT NULL
	,DESCR_IMAGEN VARCHAR2(50)
		CONSTRAINT PET_DESC_NN NOT NULL
);

CREATE TABLE PASOS (
	ID_PASO     NUMBER GENERATED BY DEFAULT AS IDENTITY
		CONSTRAINT PASOS_ID_PK PRIMARY KEY
	,ID_RECETA   NUMBER
		CONSTRAINT PASOS_ID_REC_NN NOT NULL
		CONSTRAINT PASOS_ID_REC_FK
			REFERENCES RECETAS ( ID_RECETA )
	,INDICE_PASO NUMBER
		CONSTRAINT PASOS_IND_PASO_NN NOT NULL
	,NOTAS       VARCHAR2(200)
		CONSTRAINT PASOS_NOTAS_NN NOT NULL
	,IMAGEN BLOB
	,ID_PET_IA   NUMBER
		CONSTRAINT PASOS_ID_PET_IA_FK
			REFERENCES PETICION_IA ( ID_PETICION_IA )
);

DROP TABLE RECETA_INGRED CASCADE CONSTRAINTS;
DROP TABLE USUARIOS CASCADE CONSTRAINTS;
DROP TABLE ROL CASCADE CONSTRAINTS;
DROP TABLE INGREDIENTES CASCADE CONSTRAINTS;
DROP TABLE RECETAS CASCADE CONSTRAINTS;
DROP TABLE PETICION_IA CASCADE CONSTRAINTS;
DROP TABLE PASOS CASCADE CONSTRAINTS;